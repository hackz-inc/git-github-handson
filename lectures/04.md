# 基本的な使い方 その 3

## 【目次】

1. [はじめに](#はじめに)
2. [ブランチとは](#ブランチとは)
3. [ブランチ操作](#ブランチ操作)
4. [実際にやってみよう](#実際にやってみよう)
5. [Merge](#merge)
6. [Pull Request](#pull-request)
7. [マージする](#マージする)
8. [ローカルに反映](#ローカルに反映)
9. [さいごに](#さいごに)

## 【はじめに】

ここでは**チーム開発**を行う上で必須なブランチを使った機能について紹介していきます。  
この機能はチーム開発だけではなく、個人開発でも使うのでしっかり理解しましょう！

## 【ブランチとは】

ブランチとは、1 つのプロジェクトから分岐させることにより、プロジェクト本体に影響を与えずに開発を行える機能のことを言います。  
イメージとしてはパラレルワールドを作成して、のちに元の世界に収束させることもできる、という感じです。  
リポジトリを作ると main(or master)という名前のブランチが作成されます。

よく使われる開発のブランチとして、以下が挙げられます。  
main ブランチ: リリースした時点のソースコードを管理するブランチ(安定しているコードを置く)  
develop ブランチ: 開発作業中の安定したブランチ(main ブランチへマージされます)  
開発ブランチ: 実際にコードを`push`していくブランチ(develop ブランチへマージされます)  

実際のブランチの動きが以下の画像のようになります。

1. main ブランチ
2. develop ブランチ
3. 開発ブランチ

<img width="800" alt="スクリーンショット 2022-12-06 23 54 12" src="https://user-images.githubusercontent.com/50654077/205947714-eaedf860-f68b-4686-952d-2099468b359c.png">

## 【ブランチ操作】

ブランチ操作では以下の二つのコマンドをよく使用します。

### bracnh

`branch`コマンドで、ブランチの確認や操作をすることができます。

以下はブランチ確認する時のコマンドです。

```bash
// ローカルのブランチ一覧を確認する
$ git branch

// リモートのブランチを確認する
$ git branch -r

// 全てのブランチを確認する
$ git branch -a
```

以下はブランチを操作する時のコマンドです。

```bash
// ブランチの新規作成
$ git branch [ブランチ名]

// 今いるブランチの名前を変更する
$ git branch -m [新しいブランチ名]

// ブランチを削除する
$ git branch -d [ブランチ名]
```

### switch

`switch`コマンドで、ブランチの切り替えをすることができます。

```bash
// 既存のブランチへ切り替え
$ git switch [ブランチ名]

// ブランチを新規作成と切り替え
$ git switch -c [ブランチ名]
```

で、ブランチの作成と切り替えができます。

ブランチを移動したら、そのブランチで開発しコミットしていきます。

### ブランチを切って開発する時

main ブランチ以外で作業した時に注意することがあります。

それは、`push`, `pull`をするときにリモートの情報とブランチを指定してあげる必要があります。

やり方は単純です。  
以下のコマンドを使用します。

```bash
$ git push origin [ブランチ名]
$ git pull origin [ブランチ名]
```

リモートの情報を指定と言いましたが、`origin`と書いている部分がそこに当たります。  
これは最初に設定しているので、今は特に気にしなくても大丈夫です。

## 【実際にやってみよう】

では、実際にブランチを切ってコードを変更してみます。

まずは、ローカルが最新であることを確認するために`pull`しておきます。

```bash
$ git pull
```

今のブランチが`main`であることを確認します。

```bash
$ git branch
```

次に、ブランチを切ります。  
今回は仮に`test-1`という名前のブランチを作成します。  
(こだわりがある人は自分の好きなブランチ名でも構いません)

```bash
$ git switch -c test-1
```

正しくブランチが変更されているか確認します。

```bash
$ git branch
```

`test-1`というブランチが作成され、そこへ移動していれば OK です。

では、ファイルを修正していきましょう。  
`index.js`を、[`index_04.js`](../src/index_04.js) のように変更しましょう！

変更前

```js:index.js
console.log("Hello, world!");

function test() {
  console.log("test");
}

test();
```

変更後

```js:index.js
function hello() {
  console.log("Hello, world!");
}

hello();
```

変更が完了したら、コミットしていきます。

```bash
$ git add .
$ git commit -m "Add hello function"
```

コミットが完了したら`test-1`ブランチをリモートへ反映させます。

```bash
$ git push origin test-1
```

リモートで、ブランチが増えていることを確認できたら完了です！  
「main」の部分を選択すると、「test-1」を選択することができるようになっていると思います。

<img width="800" alt="スクリーンショット 2022-12-11 19 15 28" src="https://user-images.githubusercontent.com/50654077/206954993-ab0caa9a-5d07-4580-96f1-682d1d2017ad.png">

## 【Merge】

ブランチを切って作業した時にそのブランチの変更内容を元のブランチに反映させたくなります。  
その時に、切ったブランチと元のブランチを合流させます。  
これを`Merge`と言います。

<img width="800" alt="スクリーンショット 2022-12-11 18 54 03" src="https://user-images.githubusercontent.com/50654077/206897145-dd802825-1462-41a6-808d-7a00c71affe2.png">

この操作はコマンドで行うことができるのですが、コンフリクトなどのバグが一番起こりやすい操作となります。  
ですので、安全にマージさせるために **Pull Request** という機能を使用します。

## 【Pull Request】

### Pull Request の作成

Pull Request とは簡単に言うと、**開発者のローカルリポジトリでの変更を他の開発者に通知する機能**です。  
Pull Request を使うと、以下のようなメリットがあります。

- 機能追加や改修などの作業内容を他開発者に通知
- ソースコードの変更箇所を分かりやすく表示
- ソースコードに関するコミュニケーションの場の提供

Pull Request は GitHub 上で行います。  
まずは、ブランチを切って作業した後に`commit`, `push`まで行います。  
(この時、先述の通りブランチ名を指定して push することを気をつけて下さい。)

次に、GitHub 上で Pull Request を作成します。  
ブランチを更新して`push`すると以下の画像のように、自動で Pull Request を作成するとこができるボタンが出てくるので、  
このボタンを選択して作成します。

<img width="800" alt="スクリーンショット 2022-12-11 19 15 28" src="https://user-images.githubusercontent.com/50654077/206941455-f6a10d26-aa34-4fc6-a422-3a5f82181d6e.png">

また、以下のように手動でブランチを選択して Pull Request を作成することも可能です。  
この場合には、まず「Pull requests」タブから、「New pull request」ボタンを選択します。

<img width="800" alt="スクリーンショット 2022-12-11 19 15 49" src="https://user-images.githubusercontent.com/50654077/206941492-a588ff3c-5a36-490f-aa25-948a182418c4.png">

次に、どのブランチをどのブランチにマージさせるのかを選択して、「Create pull request」を選択します。

<img width="800" alt="スクリーンショット 2022-12-11 19 16 43" src="https://user-images.githubusercontent.com/50654077/206941510-a693fe6b-7387-44da-bb81-d4ba326436c9.png">

どちらの方法でも、次に以下のような画面が出てきます。
ここに、Pull Request の内容を書いていきます。

1. まずタイトルにやったことを簡単に記述します。
2. 次に詳細をマークダウン形式で入力します。  
   ここには、他の人が見たときにも分かりやすいことを意識して内容を書きましょう。
3. ここは様々なオプションをつけることができるのですが、現在は特に追加するものがないので飛ばします。
4. 上記の入力が完了したら、作成をします。

<img width="800" alt="スクリーンショット 2022-12-11 19 19 37" src="https://user-images.githubusercontent.com/50654077/206941577-7bf350fc-c310-42e8-85a7-dbdcff540633.png">

以下のようにな画面が出てきたら完了です！

<img width="800" alt="スクリーンショット 2022-12-11 19 39 30" src="https://user-images.githubusercontent.com/50654077/206941611-def19c08-b67b-48aa-ad18-46fc2b204bc8.png">

### Pull Request の見方、レビュー

まずは、先ほどの画像がメインの画面になります。  
ここでは、Pull Request 作成時に入力した項目が表示されます。  
また、コメントがあった際にはここに表示されます。

次に、「Commits」のタブです。  
ここでは、ブランチのコミット履歴が一覧で表示されます。  
コミットのを選択すると、そのコミット単位での変更が表示されます。

<img width="800" alt="スクリーンショット 2022-12-11 19 39 41" src="https://user-images.githubusercontent.com/50654077/206944526-c7ccea0f-5742-4506-a4e0-1b8902301462.png">

「Checks」については、今は気にしなくていいので説明を省略します。

続いて、「Files changed」のタブです。  
ここでは、このブランチで行ったファイルの変更を見ることができます。

<img width="800" alt="スクリーンショット 2022-12-11 19 39 56" src="https://user-images.githubusercontent.com/50654077/206944538-13605c8e-ebd9-45ba-9e13-92e026bf194d.png">

ここでは、変更に対して実際のコードを指定してコメントを追加することができます。  
個人開発のみではコメントは特にする機会はないかとは思いますが、チーム開発をする上でとても便利です。  
ここで書いたコメントは「Start a review」を選択した場合には下記で説明する、レビューを行わないと実際に反映されないので注意して下さい。

<img width="800" alt="スクリーンショット 2022-12-11 19 41 12" src="https://user-images.githubusercontent.com/50654077/206944620-e36a7806-eb9e-482c-aadc-cce093d13191.png">

では、Pull Request のレビューをしていきます。
自分が出した Pull Request なので、承認などはできませんが説明だけしておきます。

1. まずは「Review changes」を選択します。
2. 次にコメント(Pull Request 全体に対して)を書きます。
3. レビュー結果の種類を選択します。  
   内容は以下の 3 つが存在します。  
   a. **Comment**: ただのコメントです。  
   b. **Approve**: このブランチをマージして OK と言う承認です。  
   c. **Request changes**: 修正依頼など承認しない場合に選択します。
4. 上記全てを選択したら「Submit review」を押して完了です。

<img width="800" alt="スクリーンショット 2022-12-11 19 41 25" src="https://user-images.githubusercontent.com/50654077/206944637-e3defd0c-db8b-44d3-a35b-95a5e3e15ded.png">

## 【マージする】

では、実際に`test-1`ブランチを`main`ブランチへマージしましょう。  
やり方は簡単です。

まずは、「Merge pull request」を選択します。

<img width="800" alt="スクリーンショット 2022-12-12 11 04 35" src="https://user-images.githubusercontent.com/50654077/206948166-80c8fb46-4ee5-45da-bdce-fcbb1447ce2c.png">

すると以下のような表示に切り替わるので、続けて「Confirm merge」を選択します

<img width="800" alt="スクリーンショット 2022-12-12 11 04 48" src="https://user-images.githubusercontent.com/50654077/206948175-a5a2d588-e108-4524-9c47-d9a17eea2fb1.png">

これでマージが完了しました！  
リモートのブランチはもう必要ないので、削除しておきます。

<img width="800" alt="スクリーンショット 2022-12-12 11 05 03" src="https://user-images.githubusercontent.com/50654077/206948179-9be2c708-23cc-4482-98a8-fdb58136030c.png">

では、実査に main に反映されているかチェックしてみましょう。  
「Code」タブから`index.js`の中身を見てみて下さい。  
正しく反映されていることが確認できました。

<img width="800" alt="スクリーンショット 2022-12-12 11 26 31" src="https://user-images.githubusercontent.com/50654077/206948184-5f177860-aea1-4bf1-aa84-8c6971d9c9b9.png">

## 【ローカルに反映】

現状は、リモートブランチのみがマージされた状態なので、main ブランチをローカルに反映させます。  
以下のコマンドを入力して下さい。

まずは、`main`ブランチへ移動します。

```bash
$ git switch main
```

リモートの状態をローカルに反映させます。

```bash
$ git pull
```

自分のコードを確認して、`index.js`が更新されていれば成功です！

## 【さいごに】

ここまでの流れは非常に多く使うので、何度も練習して使い慣れましょう！

[前の資料](03.md) [次の資料](05.md)
